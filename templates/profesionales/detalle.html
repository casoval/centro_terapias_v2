{% extends 'base.html' %}

{% block title %}{{ profesional.nombre_completo }} - Centro Infantil Misael{% endblock %}

{% block content %}
<style>
    .card-detalle { transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card-detalle:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.05); }
</style>

<div class="mb-8">
    <div class="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 rounded-3xl p-6 shadow-xl relative overflow-hidden">
        <div class="absolute top-0 right-0 -mr-8 -mt-8 w-40 h-40 rounded-full bg-white opacity-10 blur-3xl"></div>
        <div class="absolute bottom-0 left-10 w-20 h-20 rounded-full bg-teal-300 opacity-20 blur-xl"></div>

        <div class="relative flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <div class="flex items-center gap-3 text-emerald-100 text-xs font-bold uppercase tracking-wider mb-1">
                    <span>ID: #{{ profesional.id }}</span>
                    <span>‚Ä¢</span>
                    <span>Perfil Profesional</span>
                </div>
                <h1 class="text-2xl sm:text-3xl font-black text-white flex items-center gap-3 flex-wrap">
                    {{ profesional.nombre_completo }}
                    <span class="px-3 py-1 text-xs font-bold rounded-full border border-white/20 backdrop-blur-md shadow-sm
                        {% if profesional.activo %} bg-green-400/30 text-green-50
                        {% else %} bg-gray-500/20 text-gray-200 {% endif %}">
                        {% if profesional.activo %}ACTIVO{% else %}INACTIVO{% endif %}
                    </span>
                </h1>
            </div>
            <a href="{% url 'profesionales:lista' %}" 
               class="bg-white/10 hover:bg-white hover:text-emerald-600 text-white px-5 py-2 rounded-full font-bold text-xs transition-all border border-white/20 backdrop-blur-md flex items-center gap-2">
                <span>‚Üê</span> Volver a Lista
            </a>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-12 gap-8 pb-10">
    
    <div class="lg:col-span-4 space-y-6">
        
        <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden card-detalle">
            <div class="bg-gradient-to-b from-emerald-50 to-white p-8 pb-0 flex flex-col items-center relative">
                <div class="relative group">
                    {% if profesional.tiene_foto %}
                        <img src="{{ profesional.foto.url }}" 
                             alt="{{ profesional.nombre_completo }}"
                             class="w-36 h-36 rounded-full object-cover border-4 border-white shadow-xl group-hover:scale-105 transition-transform duration-300">
                    {% else %}
                        <div class="w-36 h-36 rounded-full bg-emerald-100 border-4 border-white shadow-xl flex items-center justify-center text-5xl text-emerald-300">
                            üë®‚Äç‚öïÔ∏è
                        </div>
                    {% endif %}
                </div>
                
                <div class="mt-4 text-center pb-6">
                    <p class="text-emerald-600 text-sm font-black uppercase tracking-wide">{{ profesional.especialidad }}</p>
                    <p class="text-xs text-gray-400 mt-1">{% if profesional.user %}@{{ profesional.user.username }}{% endif %}</p>
                </div>
            </div>

            <div class="p-6 pt-0">
                <div class="grid grid-cols-3 gap-2 mb-6">
                    <div class="bg-blue-50 rounded-2xl p-3 text-center border border-blue-100">
                        <span class="block text-xl font-black text-blue-600">{{ servicios.count }}</span>
                        <span class="text-[9px] text-blue-400 font-bold uppercase">Servicios</span>
                    </div>
                    <div class="bg-purple-50 rounded-2xl p-3 text-center border border-purple-100">
                        <span class="block text-xl font-black text-purple-600">{{ sucursales.count }}</span>
                        <span class="text-[9px] text-purple-400 font-bold uppercase">Sucursales</span>
                    </div>
                    <div class="bg-orange-50 rounded-2xl p-3 text-center border border-orange-100">
                        <span class="block text-xl font-black text-orange-600">{{ pacientes.count }}</span>
                        <span class="text-[9px] text-orange-400 font-bold uppercase">Pacientes</span>
                    </div>
                </div>

                <div class="space-y-4 mb-6">
                    {% if profesional.telefono %}
                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl border border-gray-100">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center text-gray-400 shadow-sm">üìû</div>
                        <div>
                            <p class="text-[9px] text-gray-400 font-bold uppercase">Tel√©fono</p>
                            <a href="tel:{{ profesional.telefono }}" class="text-sm font-bold text-gray-800 hover:text-emerald-600">{{ profesional.telefono }}</a>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profesional.email %}
                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl border border-gray-100">
                        <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center text-gray-400 shadow-sm">üìß</div>
                        <div class="min-w-0">
                            <p class="text-[9px] text-gray-400 font-bold uppercase">Email</p>
                            <a href="mailto:{{ profesional.email }}" class="text-sm font-bold text-gray-800 hover:text-emerald-600 truncate block">{{ profesional.email }}</a>
                        </div>
                    </div>
                    {% endif %}
                </div>

                {% if request.user.is_superuser or not request.user.perfil.es_recepcionista %}
                <a href="{% url 'profesionales:editar' profesional.id %}" 
                   class="flex items-center justify-center w-full px-4 py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 transition-all font-bold text-xs shadow-md hover:shadow-lg gap-2">
                    <span>‚úèÔ∏è</span> Editar Informaci√≥n
                </a>
                {% endif %}
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden card-detalle">
            <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                <h3 class="font-bold text-gray-800 text-sm flex items-center gap-2">
                    <span>üè•</span> Servicios Habilitados
                </h3>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    {% for servicio in servicios %}
                    <div class="flex items-center justify-between p-3 bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition-all group">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-lg bg-emerald-50 flex items-center justify-center text-emerald-600 group-hover:bg-emerald-100 transition-colors">
                                <span class="text-xs">ü©∫</span>
                            </div>
                            <div>
                                <p class="text-sm font-bold text-gray-800 group-hover:text-emerald-600 transition-colors">{{ servicio.nombre }}</p>
                                <p class="text-[10px] text-gray-400 font-medium">{{ servicio.duracion_minutos }} min</p>
                            </div>
                        </div>
                        <span class="px-2.5 py-1 text-[10px] font-bold rounded-lg" 
                              style="background-color: {{ servicio.color }}15; color: {{ servicio.color }};">
                            ${{ servicio.precio }}
                        </span>
                    </div>
                    {% empty %}
                    <div class="p-8 text-center text-gray-400 text-xs italic">Sin servicios asignados</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="lg:col-span-8 space-y-8">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden flex flex-col h-full card-detalle">
                <div class="p-4 border-b border-gray-100 bg-gray-50/50">
                    <h3 class="text-sm font-bold text-gray-800 flex items-center gap-2">
                        <span>üè¢</span> Sucursales
                    </h3>
                </div>
                <div class="divide-y divide-gray-100 flex-1">
                    {% for sucursal in sucursales %}
                    <div class="p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex flex-col h-full justify-between gap-2">
                            <div>
                                <p class="font-bold text-gray-800 text-sm">{{ sucursal.nombre }}</p>
                                <p class="text-xs text-gray-500 mt-1 flex items-start gap-1">
                                    üìç {{ sucursal.direccion }}
                                </p>
                            </div>
                            <a href="{% url 'servicios:detalle_sucursal' sucursal.id %}" class="text-emerald-600 hover:text-emerald-800 text-[10px] font-bold uppercase tracking-wide inline-flex items-center gap-1 self-start bg-emerald-50 px-2 py-1 rounded transition-colors">
                                Ver detalles <span>‚Üí</span>
                            </a>
                        </div>
                    </div>
                    {% empty %}
                    <div class="p-8 text-center text-gray-400 text-xs italic">Sin sucursales asignadas</div>
                    {% endfor %}
                </div>
            </div>

            <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden flex flex-col h-full card-detalle">
                <div class="p-4 border-b border-gray-100 bg-gray-50/50">
                    <h3 class="text-sm font-bold text-gray-800 flex items-center gap-2">
                        <span>üë•</span> Pacientes Activos
                    </h3>
                </div>
                <div class="divide-y divide-gray-100 flex-1 max-h-[300px] overflow-y-auto custom-scrollbar">
                    {% for paciente in pacientes %}
                    <div class="p-4 hover:bg-gray-50 transition-colors group">
                        <div class="flex items-center gap-3">
                            {% if paciente.tiene_foto %}
                                <img src="{{ paciente.get_foto_thumbnail }}" 
                                     class="w-10 h-10 rounded-full object-cover border border-gray-200 shadow-sm">
                            {% else %}
                                <div class="w-10 h-10 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center border border-indigo-100 font-bold text-xs">
                                    {{ paciente.nombre_completo|slice:":2"|upper }}
                                </div>
                            {% endif %}
                            
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-start">
                                    <p class="font-bold text-gray-800 text-sm truncate">{{ paciente.nombre_completo }}</p>
                                    <a href="{% url 'pacientes:detalle' paciente.id %}" class="text-gray-300 hover:text-emerald-600 transition-colors">
                                        üëÅÔ∏è
                                    </a>
                                </div>
                                <p class="text-xs text-gray-500">{{ paciente.edad }} a√±os</p>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="p-8 text-center text-gray-400 text-xs italic">Sin pacientes asignados a√∫n</div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-3xl shadow-lg border border-gray-100 overflow-hidden">
            <div class="p-6 border-b border-gray-100 bg-gray-50/30">
                <h3 class="text-lg font-black text-gray-800">√öltimas Sesiones Realizadas</h3>
            </div>
            
            <div class="p-6 sm:p-8 bg-white">
                <div class="relative">
                    <div class="absolute left-6 top-0 bottom-0 w-0.5 bg-gray-100"></div>

                    <div class="space-y-8">
                        {% for sesion in sesiones %}
                        <div class="relative pl-14 group">
                            <div class="absolute left-[20px] top-4 w-3 h-3 rounded-full border-2 border-white shadow-md z-10 
                                {% if sesion.estado == 'realizada' %} bg-green-500
                                {% elif sesion.estado == 'programada' %} bg-blue-500
                                {% elif sesion.estado == 'cancelada' %} bg-red-500
                                {% else %} bg-gray-300 {% endif %}">
                            </div>

                            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 hover:shadow-lg hover:border-emerald-100 transition-all">
                                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="px-3 py-1 rounded-lg bg-gray-50 border border-gray-100 text-center">
                                            <span class="block text-[10px] uppercase text-gray-400 font-bold">{{ sesion.fecha|date:"M" }}</span>
                                            <span class="block text-lg font-black text-gray-800 leading-none">{{ sesion.fecha|date:"d" }}</span>
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-gray-900">{{ sesion.fecha|date:"l" }}</p>
                                            <p class="text-xs text-gray-500 font-medium">{{ sesion.hora_inicio|time:"H:i" }} hrs</p>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        {% if sesion.estado == 'programada' %}
                                        <span class="px-3 py-1 text-[10px] font-bold uppercase rounded-full bg-blue-50 text-blue-700 border border-blue-100">Programada</span>
                                        {% elif sesion.estado == 'realizada' %}
                                        <span class="px-3 py-1 text-[10px] font-bold uppercase rounded-full bg-green-50 text-green-700 border border-green-100">Realizada</span>
                                        {% elif sesion.estado == 'cancelada' %}
                                        <span class="px-3 py-1 text-[10px] font-bold uppercase rounded-full bg-red-50 text-red-700 border border-red-100">Cancelada</span>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="flex flex-wrap gap-2 mb-3">
                                    <span class="inline-block px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide border" 
                                          style="background-color: {{ sesion.servicio.color }}10; color: {{ sesion.servicio.color }}; border-color: {{ sesion.servicio.color }}30;">
                                        {{ sesion.servicio.nombre }}
                                    </span>
                                </div>

                                <div class="flex flex-wrap gap-4 pt-3 border-t border-gray-50">
                                    <div class="flex items-center gap-1.5">
                                        <div class="w-5 h-5 rounded-full bg-gray-100 flex items-center justify-center text-[10px]">üë∂</div>
                                        <span class="text-xs font-bold text-gray-600">Pac: {{ sesion.paciente.nombre_completo }}</span>
                                    </div>
                                    <div class="flex items-center gap-1.5">
                                        <div class="w-5 h-5 rounded-full bg-gray-100 flex items-center justify-center text-[10px]">üè¢</div>
                                        <span class="text-xs font-medium text-gray-500">{{ sesion.sucursal.nombre }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-12">
                            <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center text-3xl mx-auto mb-4 text-gray-300">üìÖ</div>
                            <p class="text-gray-500 text-sm font-medium">No hay historial de sesiones registrado.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}