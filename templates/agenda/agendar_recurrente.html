{% extends 'base.html' %}
{% load static %}

{% block title %}Agendar Sesiones Recurrentes{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Header -->
        <div class="mb-6">
            <a href="{% url 'agenda:calendario' %}" class="text-blue-600 hover:text-blue-800 flex items-center gap-2 mb-4">
                ‚Üê Volver a la Agenda
            </a>
            <h1 class="text-3xl font-bold text-gray-900">‚ûï Agendar Sesiones Recurrentes</h1>
            <p class="text-gray-600 mt-2">Programa m√∫ltiples sesiones de forma autom√°tica</p>
        </div>

        <!-- Formulario -->
        <form method="post" class="bg-white rounded-lg shadow-lg p-6 space-y-6">
            {% csrf_token %}

            <!-- Paciente -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">üë§ Paciente *</label>
                <select name="paciente" 
                        id="paciente-select"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                        hx-get="{% url 'agenda:servicios_paciente' %}"
                        hx-target="#servicios-container"
                        hx-swap="innerHTML"
                        hx-trigger="change"
                        hx-include="this"
                        required>
                    <option value="">Seleccione un paciente</option>
                    {% for paciente in pacientes %}
                    <option value="{{ paciente.id }}">{{ paciente.nombre }} {{ paciente.apellido }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Servicio (se carga con HTMX) -->
            <div id="servicios-container">
                <label class="block text-sm font-medium text-gray-700 mb-2">üè• Servicio *</label>
                <select name="servicio" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" disabled required>
                    <option value="">Primero seleccione un paciente</option>
                </select>
            </div>

            <!-- Profesional -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">üë®‚Äç‚öïÔ∏è Profesional *</label>
                <select name="profesional" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    <option value="">Seleccione un profesional</option>
                    {% for profesional in profesionales %}
                    <option value="{{ profesional.id }}">{{ profesional.nombre }} {{ profesional.apellido }} - {{ profesional.especialidad }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Sucursal -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">üè¢ Sucursal *</label>
                <select name="sucursal" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    <option value="">Seleccione una sucursal</option>
                    {% for sucursal in sucursales %}
                    <option value="{{ sucursal.id }}">{{ sucursal.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Rango de fechas -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ Fecha de Inicio *</label>
                    <input type="date" 
                           name="fecha_inicio" 
                           id="fecha-inicio"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                           hx-get="{% url 'agenda:vista_previa' %}"
                           hx-trigger="change, keyup changed delay:500ms"
                           hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                           hx-target="#vista-previa"
                           required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ Fecha de Fin *</label>
                    <input type="date" 
                           name="fecha_fin" 
                           id="fecha-fin"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                           hx-get="{% url 'agenda:vista_previa' %}"
                           hx-trigger="change, keyup changed delay:500ms"
                           hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                           hx-target="#vista-previa"
                           required>
                </div>
            </div>

            <!-- Hora -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">üïê Hora de Inicio *</label>
                <input type="time" 
                       name="hora" 
                       id="hora"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                       hx-get="{% url 'agenda:vista_previa' %}"
                       hx-trigger="change"
                       hx-include="[name='paciente'], [name='profesional'], [name='servicio'], [name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                       hx-target="#vista-previa"
                       required>
            </div>

            <!-- D√≠as de la semana -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-3">üìÜ D√≠as de la Semana *</label>
                <div class="grid grid-cols-7 gap-2">
                    <label class="flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" 
                               name="dias_semana" 
                               value="0"
                               class="mb-2"
                               hx-get="{% url 'agenda:vista_previa' %}"
                               hx-trigger="change"
                               hx-include="[name='paciente'], [name='profesional'], [name='servicio'], [name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                               hx-target="#vista-previa">
                        <span class="text-sm font-medium">Lun</span>
                    </label>
                    <label class="flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" name="dias_semana" value="1" class="mb-2"
                               hx-get="{% url 'agenda:vista_previa' %}"
                               hx-trigger="change"
                               hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                               hx-target="#vista-previa">
                        <span class="text-sm font-medium">Mar</span>
                    </label>
                    <label class="flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" name="dias_semana" value="2" class="mb-2"
                               hx-get="{% url 'agenda:vista_previa' %}"
                               hx-trigger="change"
                               hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                               hx-target="#vista-previa">
                        <span class="text-sm font-medium">Mi√©</span>
                    </label>
                    <label class="flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" name="dias_semana" value="3" class="mb-2"
                               hx-get="{% url 'agenda:vista_previa' %}"
                               hx-trigger="change"
                               hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                               hx-target="#vista-previa">
                        <span class="text-sm font-medium">Jue</span>
                    </label>
                    <label class="flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" name="dias_semana" value="4" class="mb-2"
                               hx-get="{% url 'agenda:vista_previa' %}"
                               hx-trigger="change"
                               hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                               hx-target="#vista-previa">
                        <span class="text-sm font-medium">Vie</span>
                    </label>
                    <label class="flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" name="dias_semana" value="5" class="mb-2"
                               hx-get="{% url 'agenda:vista_previa' %}"
                               hx-trigger="change"
                               hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                               hx-target="#vista-previa">
                        <span class="text-sm font-medium">S√°b</span>
                    </label>
                    <label class="flex flex-col items-center p-3 border rounded-lg cursor-pointer hover:bg-blue-50 transition">
                        <input type="checkbox" name="dias_semana" value="6" class="mb-2"
                               hx-get="{% url 'agenda:vista_previa' %}"
                               hx-trigger="change"
                               hx-include="[name='fecha_inicio'], [name='fecha_fin'], [name='hora'], [name='dias_semana']"
                               hx-target="#vista-previa">
                        <span class="text-sm font-medium">Dom</span>
                    </label>
                </div>
            </div>

            <!-- Vista previa -->
            <div id="vista-previa" class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                <p class="text-sm text-gray-600 text-center">Seleccione las fechas y d√≠as para ver la vista previa</p>
            </div>

            <!-- Botones -->
            <div class="flex gap-4 pt-4">
                <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition">
                    ‚úÖ Generar Sesiones
                </button>
                <a href="{% url 'agenda:calendario' %}" class="px-6 py-3 border border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}