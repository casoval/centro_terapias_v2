{% load fecha_tags %}

{% if error %}
<div class="bg-red-50 border border-red-200 rounded-lg p-4">
    <p class="text-red-800 text-sm">‚ùå Error: {{ error }}</p>
</div>

{% elif mensaje %}
<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
    <p class="text-blue-800 text-sm">‚ÑπÔ∏è {{ mensaje }}</p>
</div>

{% elif sesiones %}
<!-- Resumen -->
<div class="bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4 mb-4">
    <div class="flex items-center justify-between">
        <div>
            <h3 class="text-lg font-bold text-blue-900">üìã Vista Previa de Sesiones</h3>
            <p class="text-sm text-blue-700 mt-1">Revisa las sesiones antes de crearlas</p>
        </div>
        <div class="text-right">
            <div class="text-3xl font-bold text-blue-900">{{ total }}</div>
            <div class="text-xs text-blue-700">sesiones totales</div>
        </div>
    </div>
    
    <!-- Estad√≠sticas -->
    <div class="grid grid-cols-2 gap-3 mt-4">
        <div class="bg-white rounded-lg p-3 border border-green-200">
            <div class="flex items-center gap-2">
                <span class="text-2xl">‚úÖ</span>
                <div>
                    <div class="text-xl font-bold text-green-600">{{ disponibles }}</div>
                    <div class="text-xs text-gray-600">Disponibles</div>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg p-3 border border-red-200">
            <div class="flex items-center gap-2">
                <span class="text-2xl">‚ö†Ô∏è</span>
                <div>
                    <div class="text-xl font-bold text-red-600">{{ con_conflicto }}</div>
                    <div class="text-xs text-gray-600">Con conflictos</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Lista de sesiones -->
<div class="max-h-96 overflow-y-auto space-y-2">
    {% for sesion in sesiones %}
    <div class="border rounded-lg p-3 {% if sesion.disponible %}bg-green-50 border-green-200{% else %}bg-red-50 border-red-200{% endif %}">
        <div class="flex items-start justify-between">
            <!-- Informaci√≥n de la sesi√≥n -->
            <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                    {% if sesion.disponible %}
                    <span class="text-lg">‚úÖ</span>
                    <span class="font-semibold text-green-700">Disponible</span>
                    {% else %}
                    <span class="text-lg">‚ö†Ô∏è</span>
                    <span class="font-semibold text-red-700">
                        {% if sesion.tipo_error == 'paciente' %}
                            Choque con Paciente
                        {% else %}
                            Choque con Profesional
                        {% endif %}
                    </span>
                    {% endif %}
                </div>
                
                <!-- Fecha y hora -->
                <div class="text-sm text-gray-700 mb-1">
                    <span class="font-medium">üìÖ {{ sesion.fecha|fecha_larga }}</span>
                </div>
                <div class="text-sm text-gray-700">
                    <span class="font-medium">üïê {{ sesion.hora_inicio|time:"H:i" }} - {{ sesion.hora_fin|time:"H:i" }}</span>
                </div>
                
                <!-- Mensaje de error si hay conflicto -->
                {% if not sesion.disponible %}
                <div class="mt-2 p-2 bg-white rounded border {% if sesion.tipo_error == 'paciente' %}border-orange-300{% else %}border-purple-300{% endif %}">
                    <p class="text-xs {% if sesion.tipo_error == 'paciente' %}text-orange-700{% else %}text-purple-700{% endif %}">
                        <strong>Motivo:</strong> {{ sesion.mensaje_error }}
                    </p>
                </div>
                {% endif %}
            </div>
            
            <!-- Icono de estado -->
            <div class="ml-3">
                {% if sesion.disponible %}
                <div class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center">
                    <span class="text-white text-xl">‚úì</span>
                </div>
                {% else %}
                <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center">
                    <span class="text-white text-xl">‚úï</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Advertencia si hay conflictos -->
{% if con_conflicto > 0 %}
<div class="mt-4 bg-orange-50 border border-orange-200 rounded-lg p-4">
    <div class="flex items-start gap-3">
        <span class="text-2xl">‚ö†Ô∏è</span>
        <div>
            <h4 class="font-semibold text-orange-900 mb-1">Atenci√≥n: Sesiones con Conflictos</h4>
            <p class="text-sm text-orange-700">
                Hay <strong>{{ con_conflicto }}</strong> sesi√≥n(es) que no se pueden crear debido a choques de horario. 
                Solo se crear√°n las <strong>{{ disponibles }}</strong> sesiones disponibles.
            </p>
        </div>
    </div>
</div>
{% endif %}

{% else %}
<div class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center">
    <div class="text-4xl mb-3">üìÖ</div>
    <p class="text-gray-600">Selecciona las fechas, hora y d√≠as para ver la vista previa</p>
</div>
{% endif %}