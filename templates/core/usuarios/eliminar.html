{% extends 'base.html' %}

{% block title %}Eliminar Usuario - Centro Infantil Misael{% endblock %}

{% block content %}
<style>
    .btn-peligro { transition: all 0.2s ease; }
    .btn-peligro:hover { transform: scale(1.02); box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3); }
    .btn-seguro { transition: all 0.2s ease; }
    .btn-seguro:hover { transform: scale(1.02); box-shadow: 0 10px 25px rgba(251, 146, 60, 0.3); }
</style>

<div class="mb-8">
    <div class="relative bg-gradient-to-r from-red-500 via-red-600 to-red-700 rounded-3xl p-6 sm:p-8 shadow-xl overflow-hidden">
        <div class="absolute top-0 right-0 -mr-8 -mt-8 w-32 h-32 rounded-full bg-white opacity-10 blur-2xl"></div>
        <div class="absolute bottom-0 left-0 -ml-8 -mb-8 w-24 h-24 rounded-full bg-white opacity-10 blur-xl"></div>
        
        <div class="relative flex justify-between items-center">
            <div>
                <h1 class="text-2xl sm:text-3xl font-bold text-white flex items-center gap-3">
                    <span class="bg-white/20 p-2 rounded-xl backdrop-blur-sm shadow-inner">‚ö†Ô∏è</span> 
                    Zona de Peligro
                </h1>
                <p class="text-red-100 text-sm mt-2 font-medium">
                    {% if tiene_datos %}üîí Usuario protegido contra eliminaci√≥n{% else %}Est√°s a punto de eliminar una cuenta{% endif %}
                </p>
            </div>
            <a href="{% url 'core:lista_usuarios' %}" 
               class="bg-white/20 text-white px-4 py-2 rounded-xl font-bold text-sm shadow-lg hover:bg-white hover:text-red-700 transition-all backdrop-blur-md border border-white/30">
                ‚Üê Cancelar
            </a>
        </div>
    </div>
</div>

<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-3xl shadow-2xl border-4 border-red-100 overflow-hidden">
        
        <div class="bg-red-50/50 p-8 text-center border-b border-red-100">
            <div class="text-6xl mb-4 transform hover:scale-110 transition-transform cursor-default">
                {% if tiene_datos %}üîí{% else %}üóëÔ∏è{% endif %}
            </div>
            <h2 class="text-2xl font-black text-gray-800 mb-2">
                {% if tiene_datos %}
                No se puede eliminar
                {% else %}
                ¬øEliminar permanentemente?
                {% endif %}
            </h2>
            <p class="text-gray-600 font-medium">
                {% if tiene_datos %}
                Este usuario tiene datos cr√≠ticos asociados.
                {% else %}
                Esta acci√≥n borrar√° la cuenta de <span class="text-red-600 font-bold">"{{ usuario.username }}"</span>.
                {% endif %}
            </p>
        </div>
        
        <div class="p-6 bg-white">
            <div class="bg-white rounded-2xl p-4 border border-gray-100 shadow-sm flex items-center gap-4 mb-6">
                <div class="w-16 h-16 rounded-2xl flex items-center justify-center text-3xl shadow-sm border-2 border-white bg-red-50">
                    {% if usuario.perfil.es_profesional %}üë®‚Äç‚öïÔ∏è
                    {% elif usuario.perfil.es_paciente %}üß∏
                    {% elif usuario.perfil.es_recepcionista %}üìã
                    {% elif usuario.perfil.es_gerente %}üëî
                    {% else %}üë§{% endif %}
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-gray-800">{{ usuario.username }}</h3>
                    <p class="text-sm text-gray-500 font-medium mt-0.5">
                        {{ usuario.get_full_name|default:"Sin nombre registrado" }}
                    </p>
                </div>
            </div>
            
            <div class="space-y-4">
                {% if tiene_datos %}
                <div class="bg-red-50 rounded-2xl p-5 border border-red-100">
                    <p class="text-red-800 font-bold text-sm mb-3 flex items-center gap-2">
                        <span>üö´</span> BLOQUEO DE SEGURIDAD
                    </p>
                    <p class="text-sm text-red-600 mb-4">
                        Existen registros vinculados que impiden la eliminaci√≥n:
                    </p>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        {% if datos_relacionados.sesiones > 0 %}
                        <div class="bg-white p-3 rounded-xl border border-red-100 text-center shadow-sm">
                            <span class="block text-2xl font-black text-red-800">{{ datos_relacionados.sesiones }}</span>
                            <span class="text-[10px] uppercase font-bold text-red-400">Sesiones</span>
                        </div>
                        {% endif %}
                        {% if datos_relacionados.proyectos > 0 %}
                        <div class="bg-white p-3 rounded-xl border border-red-100 text-center shadow-sm">
                            <span class="block text-2xl font-black text-red-800">{{ datos_relacionados.proyectos }}</span>
                            <span class="text-[10px] uppercase font-bold text-red-400">Proyectos</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="bg-orange-50 rounded-2xl p-5 border border-orange-200">
                    <div class="flex gap-4">
                        <div class="text-3xl">üí°</div>
                        <div>
                            <h4 class="font-bold text-orange-900 mb-1">Recomendaci√≥n: Desactivar</h4>
                            <p class="text-sm text-orange-800 leading-relaxed">
                                En lugar de eliminar, puedes <strong>desactivar</strong> la cuenta. El usuario perder√° el acceso inmediatamente, pero los datos hist√≥ricos se conservar√°n seguros.
                            </p>
                        </div>
                    </div>
                </div>
                
                {% else %}
                <div class="bg-yellow-50 rounded-2xl p-5 border border-yellow-200 flex gap-4">
                    <div class="text-3xl">‚ö†Ô∏è</div>
                    <div>
                        <h4 class="font-bold text-yellow-900 mb-1">Acci√≥n Irreversible</h4>
                        <p class="text-sm text-yellow-800">
                            Si contin√∫as, el usuario y sus configuraciones de acceso se borrar√°n permanentemente.
                        </p>
                    </div>
                </div>
                
                {% if usuario.perfil.profesional or usuario.perfil.paciente %}
                <div class="bg-blue-50 rounded-2xl p-4 border border-blue-100 text-sm text-blue-800 flex gap-3">
                    <span class="text-xl">‚ÑπÔ∏è</span>
                    <p>
                        La ficha del <strong>{% if usuario.perfil.profesional %}Profesional{% else %}Paciente{% endif %}</strong> asociado 
                        NO se eliminar√°, solo se desvincular√° el acceso.
                    </p>
                </div>
                {% endif %}
                
                {% endif %}
            </div>
        </div>
        
        <div class="p-6 bg-gray-50 border-t border-gray-100">
            <form method="post" id="formEliminar" class="flex flex-col gap-3">
                {% csrf_token %}
                
                <button type="submit" 
                        name="accion"
                        value="desactivar"
                        class="btn-seguro w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-4 rounded-xl font-black text-sm shadow-lg flex justify-center items-center gap-2">
                    <span>üîí</span> DESACTIVAR CUENTA (Recomendado)
                </button>
                
                {% if not tiene_datos %}
                <button type="submit" 
                        name="accion"
                        value="eliminar"
                        onclick="return confirmarEliminacion()"
                        class="btn-peligro w-full bg-white border-2 border-red-100 text-red-600 py-3 rounded-xl font-black text-xs hover:bg-red-50 hover:border-red-200 transition-all flex justify-center items-center gap-2">
                    <span>üóëÔ∏è</span> S√ç, ELIMINAR DEFINITIVAMENTE
                </button>
                {% endif %}
                
                <a href="{% url 'core:lista_usuarios' %}" 
                   class="text-center mt-2 text-gray-400 font-bold text-xs hover:text-gray-600 transition-colors">
                    Cancelar y volver
                </a>
            </form>
        </div>
    </div>
</div>

<script>
function confirmarEliminacion() {
    return confirm(
        '‚ö†Ô∏è √öLTIMA ADVERTENCIA\n\n' +
        '¬øEst√°s ABSOLUTAMENTE SEGURO de eliminar este usuario?\n\n' +
        'Usuario: {{ usuario.username }}\n' +
        'Esta acci√≥n NO se puede deshacer.\n\n' +
        'Haz clic en ACEPTAR para continuar con la eliminaci√≥n.'
    );
}
</script>
{% endblock %}