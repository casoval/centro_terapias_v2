{% extends 'base.html' %}

{% block title %}Eliminar Usuario - Centro Infantil Misael{% endblock %}

{% block content %}
<style>
    .btn-peligro {
        transition: all 0.2s ease;
    }
    .btn-peligro:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
    }
    .btn-seguro {
        transition: all 0.2s ease;
    }
    .btn-seguro:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(251, 146, 60, 0.3);
    }
</style>

<!-- Header con advertencia -->
<div class="mb-4">
    <div class="bg-gradient-to-r from-red-500 via-red-600 to-red-700 rounded-xl p-3 shadow-lg">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-lg sm:text-xl font-black text-white flex items-center gap-2">
                    <span>‚ö†Ô∏è</span> Eliminar Usuario
                </h1>
                <p class="text-white text-[10px] font-bold opacity-90">
                    {% if tiene_datos %}üîí Usuario con datos asociados{% else %}Esta acci√≥n NO se puede deshacer{% endif %}
                </p>
            </div>
            <a href="{% url 'core:lista_usuarios' %}" 
               class="bg-white text-red-700 px-3 py-1 rounded-full font-black text-xs shadow-md hover:scale-105 transition-transform">
                ‚Üê Cancelar
            </a>
        </div>
    </div>
</div>

<!-- Tarjeta de confirmaci√≥n -->
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-2xl shadow-xl border-4 border-red-200 overflow-hidden">
        <!-- Icono de advertencia -->
        <div class="bg-red-50 p-6 text-center border-b-4 border-red-200">
            <div class="text-6xl mb-3">
                {% if tiene_datos %}üîí{% else %}üóëÔ∏è{% endif %}
            </div>
            <h2 class="text-xl font-black text-red-800 mb-2">
                {% if tiene_datos %}
                ‚ö†Ô∏è Usuario con Datos Asociados
                {% else %}
                ¬øEst√°s completamente seguro?
                {% endif %}
            </h2>
            <p class="text-sm text-red-700 font-bold">
                {% if tiene_datos %}
                Este usuario NO puede ser eliminado porque tiene datos importantes
                {% else %}
                Esta acci√≥n eliminar√° permanentemente este usuario
                {% endif %}
            </p>
        </div>
        
        <!-- Informaci√≥n del usuario -->
        <div class="p-6 bg-gradient-to-br from-gray-50 to-red-50">
            <div class="bg-white rounded-xl p-4 border-2 border-red-200 mb-4">
                <div class="flex items-center gap-3 mb-3">
                    <div class="bg-red-100 w-12 h-12 rounded-full flex items-center justify-center text-2xl">
                        {% if usuario.perfil.es_profesional %}üë®‚Äç‚öïÔ∏è
                        {% elif usuario.perfil.es_paciente %}üë§
                        {% elif usuario.perfil.es_recepcionista %}üìã
                        {% elif usuario.perfil.es_gerente %}üíº
                        {% else %}üë§{% endif %}
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-black text-gray-800">{{ usuario.username }}</h3>
                        {% if usuario.get_full_name %}
                        <p class="text-sm text-gray-600 font-bold">{{ usuario.get_full_name }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Detalles -->
                <div class="grid grid-cols-2 gap-3 mt-3 pt-3 border-t border-gray-200">
                    <div>
                        <p class="text-[9px] text-gray-500 font-bold uppercase">Rol</p>
                        <p class="text-xs font-black text-gray-800">
                            {% if usuario.perfil.rol %}
                            {{ usuario.perfil.get_rol_display }}
                            {% else %}
                            Sin rol
                            {% endif %}
                        </p>
                    </div>
                    
                    <div>
                        <p class="text-[9px] text-gray-500 font-bold uppercase">Estado</p>
                        <p class="text-xs font-black">
                            {% if usuario.is_active %}
                            <span class="text-green-600">‚úì Activo</span>
                            {% else %}
                            <span class="text-gray-500">‚úó Inactivo</span>
                            {% endif %}
                        </p>
                    </div>
                    
                    {% if usuario.email %}
                    <div class="col-span-2">
                        <p class="text-[9px] text-gray-500 font-bold uppercase">Email</p>
                        <p class="text-xs font-black text-gray-800">{{ usuario.email }}</p>
                    </div>
                    {% endif %}
                    
                    {% if usuario.perfil.profesional %}
                    <div class="col-span-2">
                        <p class="text-[9px] text-gray-500 font-bold uppercase">Vinculado con</p>
                        <p class="text-xs font-black text-green-700">üë®‚Äç‚öïÔ∏è {{ usuario.perfil.profesional }}</p>
                    </div>
                    {% endif %}
                    
                    {% if usuario.perfil.paciente %}
                    <div class="col-span-2">
                        <p class="text-[9px] text-gray-500 font-bold uppercase">Vinculado con</p>
                        <p class="text-xs font-black text-blue-700">üë§ {{ usuario.perfil.paciente }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Advertencias -->
            <div class="space-y-3">
                {% if tiene_datos %}
                <!-- ‚ùå BLOQUEO: Tiene datos asociados -->
                <div class="bg-red-50 border-3 border-red-400 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <span class="text-3xl flex-shrink-0">üö´</span>
                        <div class="flex-1">
                            <p class="text-sm font-black text-red-900 mb-2">
                                ELIMINACI√ìN BLOQUEADA
                            </p>
                            <p class="text-xs text-red-800 font-bold mb-3">
                                Este usuario tiene datos asociados que ser√≠an afectados:
                            </p>
                            <div class="grid grid-cols-2 gap-2 mb-3">
                                {% if datos_relacionados.sesiones > 0 %}
                                <div class="bg-white/70 rounded-lg p-2 border border-red-300">
                                    <p class="text-[10px] text-red-600 font-bold uppercase">Sesiones</p>
                                    <p class="text-lg font-black text-red-800">{{ datos_relacionados.sesiones }}</p>
                                </div>
                                {% endif %}
                                {% if datos_relacionados.proyectos > 0 %}
                                <div class="bg-white/70 rounded-lg p-2 border border-red-300">
                                    <p class="text-[10px] text-red-600 font-bold uppercase">Proyectos</p>
                                    <p class="text-lg font-black text-red-800">{{ datos_relacionados.proyectos }}</p>
                                </div>
                                {% endif %}
                            </div>
                            <p class="text-xs text-red-800 font-bold">
                                üí° <strong>Soluci√≥n:</strong> Usa la opci√≥n de DESACTIVAR para inhabilitar el acceso sin perder datos.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- ‚úÖ OPCI√ìN RECOMENDADA: Desactivar -->
                <div class="bg-orange-50 border-3 border-orange-300 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <span class="text-3xl flex-shrink-0">‚úÖ</span>
                        <div class="flex-1">
                            <p class="text-sm font-black text-orange-900 mb-2">
                                OPCI√ìN RECOMENDADA: Desactivar Usuario
                            </p>
                            <ul class="text-xs text-orange-800 font-bold space-y-1.5 mb-3">
                                <li>üîí El usuario NO podr√° iniciar sesi√≥n</li>
                                <li>üíæ Todos los datos se CONSERVAN intactos</li>
                                <li>üîÑ Puedes reactivarlo en cualquier momento</li>
                                <li>üìä Mantiene el historial completo</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                {% else %}
                <!-- ‚ö†Ô∏è Sin datos: Puede eliminar -->
                <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3">
                    <div class="flex items-start gap-2">
                        <span class="text-xl flex-shrink-0">‚ö†Ô∏è</span>
                        <div>
                            <p class="text-xs font-black text-yellow-800 mb-1">¬°CUIDADO!</p>
                            <ul class="text-[10px] text-yellow-700 font-bold space-y-1">
                                <li>‚Ä¢ Se eliminar√° el usuario del sistema</li>
                                <li>‚Ä¢ Se eliminar√° su perfil y permisos</li>
                                <li>‚Ä¢ NO podr√° iniciar sesi√≥n nuevamente</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                {% if usuario.perfil.profesional or usuario.perfil.paciente %}
                <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-3">
                    <div class="flex items-start gap-2">
                        <span class="text-xl flex-shrink-0">‚ÑπÔ∏è</span>
                        <div>
                            <p class="text-xs font-black text-blue-800 mb-1">Nota sobre vinculaci√≥n</p>
                            <p class="text-[10px] text-blue-700 font-bold">
                                El registro de {% if usuario.perfil.profesional %}profesional{% else %}paciente{% endif %} 
                                NO se eliminar√°, solo se remover√° la vinculaci√≥n con este usuario.
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- üí° TIP: Opci√≥n de desactivar siempre disponible -->
                <div class="bg-green-50 border-2 border-green-300 rounded-lg p-3">
                    <div class="flex items-start gap-2">
                        <span class="text-xl flex-shrink-0">üí°</span>
                        <div>
                            <p class="text-xs font-black text-green-800 mb-1">¬øMejor desactivar?</p>
                            <p class="text-[10px] text-green-700 font-bold">
                                Si solo quieres bloquear el acceso temporalmente, usa DESACTIVAR en lugar de eliminar.
                            </p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Formulario de confirmaci√≥n -->
        <div class="p-6 bg-gray-50 border-t-4 border-red-200">
            <form method="post" id="formEliminar">
                {% csrf_token %}
                
                <div class="flex flex-col gap-3">
                    <!-- OPCI√ìN 1: Desactivar (Recomendada) -->
                    <button type="submit" 
                            name="accion"
                            value="desactivar"
                            class="btn-seguro w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3.5 rounded-xl font-black text-sm shadow-lg hover:shadow-xl">
                        üîí DESACTIVAR USUARIO (Recomendado)
                    </button>
                    
                    {% if not tiene_datos %}
                    <!-- OPCI√ìN 2: Eliminar (Solo si NO tiene datos) -->
                    <button type="submit" 
                            name="accion"
                            value="eliminar"
                            onclick="return confirmarEliminacion()"
                            class="btn-peligro w-full bg-gradient-to-r from-red-600 to-red-700 text-white py-3.5 rounded-xl font-black text-sm shadow-lg hover:shadow-xl">
                        üóëÔ∏è S√ç, ELIMINAR PERMANENTEMENTE
                    </button>
                    {% endif %}
                    
                    <!-- Cancelar -->
                    <a href="{% url 'core:lista_usuarios' %}" 
                       class="text-center px-6 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-xl font-black text-sm hover:bg-gray-50 transition-colors">
                        ‚Üê Volver sin cambios
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Script de confirmaci√≥n adicional -->
<script>
function confirmarEliminacion() {
    const confirmacion = confirm(
        '‚ö†Ô∏è √öLTIMA ADVERTENCIA\n\n' +
        '¬øEst√°s ABSOLUTAMENTE SEGURO de eliminar este usuario?\n\n' +
        'Usuario: {{ usuario.username }}\n' +
        'Esta acci√≥n NO se puede deshacer.\n\n' +
        'Haz clic en ACEPTAR para continuar con la eliminaci√≥n.'
    );
    
    return confirmacion;
}
</script>
{% endblock %}